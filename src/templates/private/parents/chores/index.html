{% extends "bases/private.html" %}

{% block title %}Manage Chores - Stewardwell{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Manage Chores</h1>
        <p>Create and assign family tasks</p>
    </div>

    {% include 'private/parents/components/navbar.html' %}

    <div class="dashboard-grid">
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2>All Chores</h2>
                <button onclick="toggleModal('createChoreModal')">+ Create Chore</button>
            </div>
            <div class="card-body">
                {% if chores %}
                    <div class="row g-3">
                        {% for chore in chores %}
                        <div class="col-12 col-md-6 col-lg-4">
                        <div class="chore-item">
                            <div class="chore-main">
                                <div class="chore-name-section">
                                    <strong>{{ chore.name }}</strong>
                                    {% if not chore.is_active %}
                                        <span class="status-badge inactive">Hidden</span>
                                    {% else %}
                                        <span class="status-badge active">Active</span>
                                    {% endif %}
                                </div>
                                
                                <div class="chore-rewards-section">
                                    <span class="coin-badge">{{ chore.coin_value }} Coins</span>
                                    <span class="point-badge">{{ chore.point_value }} Points</span>
                                </div>
                                
                                <div class="chore-frequency-section">
                                    {% if chore.frequency == 'unlimited' %}
                                        <span class="frequency-badge">‚ôæÔ∏è Unlimited</span>
                                    {% elif chore.frequency == 'daily' %}
                                        <span class="frequency-badge">üìÖ Daily</span>
                                    {% elif chore.frequency == 'weekly' %}
                                        <span class="frequency-badge">üìÜ Weekly</span>
                                    {% elif chore.frequency == 'monthly' %}
                                        <span class="frequency-badge">üóìÔ∏è Monthly</span>
                                    {% elif chore.frequency == 'one_time' %}
                                        <span class="frequency-badge">üîí One Time</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="chore-actions">
                                <form method="POST" action="{{ url_for('parent.toggle_chore', chore_id=chore.id) }}" class="inline-form">
                                    <button type="submit" class="btn-secondary">
                                        {% if chore.is_active %}üëÅÔ∏è Hide{% else %}üëÅÔ∏è Show{% endif %}
                                    </button>
                                </form>
                                <button type="button" class="btn-danger" onclick="if(confirm('Delete {{ chore.name }}? This cannot be undone.')) document.getElementById('delete-form-{{ chore.id }}').submit();">
                                    üóëÔ∏è Delete
                                </button>
                                <form id="delete-form-{{ chore.id }}" method="POST" action="{{ url_for('parent.delete_chore', chore_id=chore.id) }}" style="display: none;"></form>
                            </div>
                        </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state">
                        <p>No chores created yet</p>
                        <button class="btn-primary" onclick="toggleModal('createChoreModal')" style="margin-top: var(--space-lg); padding: var(--space-md) var(--space-xl); border: var(--border-sm) solid; font-size: 1rem; font-weight: 800; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: var(--shadow-md) var(--shadow-md) 0 var(--border-primary); background: var(--accent-primary); color: #ffffff; border-color: var(--accent-primary);">
                            + Create First Chore
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Create Chore Modal -->
<div id="createChoreModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create Chore</h3>
            <span class="close" onclick="toggleModal('createChoreModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('parent.create_chore') }}">
            <div class="form-group">
                <label for="chore_name">Chore Name</label>
                <input type="text" id="chore_name" name="name" required placeholder="e.g., Clean room">
            </div>
            <div class="form-group">
                <label for="coin_value">Coin Value</label>
                <input type="number" id="coin_value" name="coin_value" min="0" value="10" required>
            </div>
            <div class="form-group">
                <label for="point_value">Point Value</label>
                <input type="number" id="point_value" name="point_value" min="0" value="1" required>
            </div>
            <div class="form-group">
                <label for="frequency">Frequency</label>
                <select id="frequency" name="frequency" required>
                    <option value="unlimited">Unlimited (anytime)</option>
                    <option value="daily">Daily (once per day)</option>
                    <option value="weekly">Weekly (once per week)</option>
                    <option value="monthly">Monthly (once per month)</option>
                    <option value="one_time">One Time Only</option>
                </select>
                <small class="help-text">How often can this chore be done?</small>
            </div>
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: var(--space-sm); text-transform: none; cursor: pointer;">
                    <input type="checkbox" id="is_active" name="is_active" checked style="width: auto; cursor: pointer;">
                    <span>Active (visible to kids)</span>
                </label>
                <small class="help-text">Uncheck to hide this chore from kids</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="toggleModal('createChoreModal')">Cancel</button>
                <button type="submit" class="btn-primary">Create Chore</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function toggleModal(modalId) {
    document.getElementById(modalId).classList.toggle('active');
}
</script>
{% endblock %}
