{% extends "bases/private.html" %}

{% block title %}Manage Chores - Stewardwell{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Manage Chores</h1>
        <p>Create and assign family tasks</p>
    </div>

    {% include 'private/parents/components/navbar.html' %}

    <div class="dashboard-grid">
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2>All Chores</h2>
                <button onclick="toggleModal('createChoreModal')">+ Create Chore</button>
            </div>
            <div class="card-body">
                {% if chores %}
                    <div class="row g-3">
                        {% for chore in chores %}
                        <div class="col-12 col-md-6 col-lg-4">
                        <div class="chore-item">
                            <div class="chore-main">
                                <div class="chore-name-section">
                                    <strong style="word-break: break-word;">{{ chore.name }}</strong>
                                    {% if not chore.is_active %}
                                        <span class="status-badge inactive">Hidden</span>
                                    {% else %}
                                        <span class="status-badge active">Active</span>
                                    {% endif %}
                                </div>
                                
                                {% if chore.description %}
                                <div class="chore-description" style="margin: var(--space-sm) 0; color: var(--text-secondary); font-size: 0.9rem; line-height: 1.4; word-break: break-word;">
                                    {{ chore.description }}
                                </div>
                                {% endif %}
                                
                                <div class="chore-rewards-section">
                                    <span class="coin-badge">{{ chore.coin_value }} Coins</span>
                                    <span class="point-badge">{{ chore.point_value }} Points</span>
                                </div>
                                
                                <div class="chore-frequency-section">
                                    {% if chore.frequency == 'unlimited' %}
                                        <span class="frequency-badge">‚ôæÔ∏è Unlimited</span>
                                    {% elif chore.frequency == 'daily' %}
                                        <span class="frequency-badge">üìÖ Daily</span>
                                    {% elif chore.frequency == 'weekly' %}
                                        <span class="frequency-badge">üìÜ Weekly</span>
                                    {% elif chore.frequency == 'monthly' %}
                                        <span class="frequency-badge">üóìÔ∏è Monthly</span>
                                    {% elif chore.frequency == 'one_time' %}
                                        <span class="frequency-badge">üîí One Time</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="chore-actions d-flex flex-wrap gap-2">
                                <button type="button" 
                                        class="btn-primary flex-fill edit-chore-btn" 
                                        data-chore-id="{{ chore.id }}"
                                        data-chore-name="{{ chore.name }}"
                                        data-chore-description="{{ chore.description or '' }}"
                                        data-chore-coin="{{ chore.coin_value }}"
                                        data-chore-point="{{ chore.point_value }}"
                                        data-chore-frequency="{{ chore.frequency }}"
                                        data-chore-active="{{ 'true' if chore.is_active else 'false' }}"
                                        style="min-width: fit-content;">
                                    ‚úèÔ∏è <span class="d-none d-sm-inline">Edit</span>
                                </button>
                                <form method="POST" action="{{ url_for('parent.toggle_chore', chore_id=chore.id) }}" class="inline-form flex-fill" style="min-width: fit-content;">
                                    <button type="submit" class="btn-secondary w-100">
                                        {% if chore.is_active %}üëÅÔ∏è <span class="d-none d-sm-inline">Hide</span>{% else %}üëÅÔ∏è <span class="d-none d-sm-inline">Show</span>{% endif %}
                                    </button>
                                </form>
                                <button type="button" class="btn-danger flex-fill delete-chore-btn" data-chore-id="{{ chore.id }}" data-chore-name="{{ chore.name }}" style="min-width: fit-content;">
                                    üóëÔ∏è <span class="d-none d-sm-inline">Delete</span>
                                </button>
                                <form id="delete-form-{{ chore.id }}" method="POST" action="{{ url_for('parent.delete_chore', chore_id=chore.id) }}" style="display: none;"></form>
                            </div>
                        </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state text-center">
                        <p style="font-size: 1.1rem; color: var(--text-muted, #666);">No chores created yet</p>
                        <button class="btn-primary" onclick="toggleModal('createChoreModal')" style="margin-top: 1.5rem;">
                            + Create First Chore
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Create Chore Modal -->
<div id="createChoreModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Create Chore</h3>
            <span class="close" onclick="toggleModal('createChoreModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('parent.create_chore') }}">
            <div class="form-group mb-3">
                <label for="chore_name">Chore Name</label>
                <input type="text" id="chore_name" name="name" required placeholder="e.g., Clean room">
            </div>
            <div class="form-group mb-3">
                <label for="chore_description">Description (Optional)</label>
                <textarea id="chore_description" name="description" rows="3" placeholder="Add details about what needs to be done..." style="resize: vertical; min-height: 4rem;"></textarea>
            </div>
            <div class="form-group mb-3">
                <label for="coin_value">Coin Value</label>
                <input type="number" id="coin_value" name="coin_value" min="0" value="10" required>
            </div>
            <div class="form-group mb-3">
                <label for="point_value">Point Value</label>
                <input type="number" id="point_value" name="point_value" min="0" value="1" required>
            </div>
            <div class="form-group mb-3">
                <label for="frequency">Frequency</label>
                <select id="frequency" name="frequency" required>
                    <option value="unlimited">Unlimited (anytime)</option>
                    <option value="daily">Daily (once per day)</option>
                    <option value="weekly">Weekly (once per week)</option>
                    <option value="monthly">Monthly (once per month)</option>
                    <option value="one_time">One Time Only</option>
                </select>
                <small class="help-text">How often can this chore be done?</small>
            </div>
            <div class="form-group mb-3">
                <label style="display: flex; align-items: center; gap: var(--space-sm); text-transform: none; cursor: pointer;">
                    <input type="checkbox" id="is_active" name="is_active" checked style="width: auto; cursor: pointer;">
                    <span>Active (visible to kids)</span>
                </label>
                <small class="help-text">Uncheck to hide this chore from kids</small>
            </div>
            <div class="modal-footer d-flex flex-wrap gap-2 justify-content-end">
                <button type="button" class="btn-secondary" onclick="toggleModal('createChoreModal')">Cancel</button>
                <button type="submit" class="btn-primary">Create Chore</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Chore Modal -->
<div id="editChoreModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Edit Chore</h3>
            <span class="close" onclick="toggleModal('editChoreModal')">&times;</span>
        </div>
        <form id="editChoreForm" method="POST">
            <div class="form-group mb-3">
                <label for="edit_chore_name">Chore Name</label>
                <input type="text" id="edit_chore_name" name="name" required placeholder="e.g., Clean room">
            </div>
            <div class="form-group mb-3">
                <label for="edit_chore_description">Description (Optional)</label>
                <textarea id="edit_chore_description" name="description" rows="3" placeholder="Add details about what needs to be done..." style="resize: vertical; min-height: 4rem;"></textarea>
            </div>
            <div class="form-group mb-3">
                <label for="edit_coin_value">Coin Value</label>
                <input type="number" id="edit_coin_value" name="coin_value" min="0" required>
            </div>
            <div class="form-group mb-3">
                <label for="edit_point_value">Point Value</label>
                <input type="number" id="edit_point_value" name="point_value" min="0" required>
            </div>
            <div class="form-group mb-3">
                <label for="edit_frequency">Frequency</label>
                <select id="edit_frequency" name="frequency" required>
                    <option value="unlimited">Unlimited (anytime)</option>
                    <option value="daily">Daily (once per day)</option>
                    <option value="weekly">Weekly (once per week)</option>
                    <option value="monthly">Monthly (once per month)</option>
                    <option value="one_time">One Time Only</option>
                </select>
                <small class="help-text">How often can this chore be done?</small>
            </div>
            <div class="form-group mb-3">
                <label style="display: flex; align-items: center; gap: var(--space-sm); text-transform: none; cursor: pointer;">
                    <input type="checkbox" id="edit_is_active" name="is_active" style="width: auto; cursor: pointer;">
                    <span>Active (visible to kids)</span>
                </label>
                <small class="help-text">Uncheck to hide this chore from kids</small>
            </div>
            <div class="modal-footer d-flex flex-wrap gap-2 justify-content-end">
                <button type="button" class="btn-secondary" onclick="toggleModal('editChoreModal')">Cancel</button>
                <button type="submit" class="btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function toggleModal(modalId) {
    document.getElementById(modalId).classList.toggle('active');
}

// Edit chore buttons - use event delegation
document.addEventListener('DOMContentLoaded', function() {
    // Handle edit buttons
    document.querySelectorAll('.edit-chore-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const choreId = this.dataset.choreId;
            const name = this.dataset.choreName;
            const description = this.dataset.choreDescription;
            const coinValue = this.dataset.choreCoin;
            const pointValue = this.dataset.chorePoint;
            const frequency = this.dataset.choreFrequency;
            const isActive = this.dataset.choreActive === 'true';
            
            // Set form action
            document.getElementById('editChoreForm').action = '/parent/edit-chore/' + choreId;
            
            // Populate form fields
            document.getElementById('edit_chore_name').value = name;
            document.getElementById('edit_chore_description').value = description || '';
            document.getElementById('edit_coin_value').value = coinValue;
            document.getElementById('edit_point_value').value = pointValue;
            document.getElementById('edit_frequency').value = frequency;
            document.getElementById('edit_is_active').checked = isActive;
            
            // Open modal
            toggleModal('editChoreModal');
        });
    });
    
    // Handle delete buttons
    document.querySelectorAll('.delete-chore-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
            const choreId = this.dataset.choreId;
            const choreName = this.dataset.choreName;
            if (confirm('Delete ' + choreName + '? This cannot be undone.')) {
                document.getElementById('delete-form-' + choreId).submit();
            }
        });
    });
});
</script>
{% endblock %}
