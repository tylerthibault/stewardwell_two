{% extends "bases/private.html" %}

{% block title %}Parent Dashboard - Bold Dark{% endblock %}

{% block content %}
<style>
/* Bold Flat Design System - Dark Mode */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

/* CSS Custom Properties for Theme System */
:root {
    /* Dark Mode Base Colors */
    --bg-primary: #0d0d0d;
    --bg-secondary: #1a1a1a;
    --bg-tertiary: #0d0d0d;
    --text-primary: #e0e0e0;
    --text-secondary: #999999;
    --text-tertiary: #b3b3b3;
    --border-primary: #333333;
    --border-secondary: #4d4d4d;
    
    /* Accent Colors (User Customizable) - Default Red */
    --accent-primary: #ff3333;
    --accent-dark: #cc0000;
    --accent-darker: #990000;
    
    /* Success Colors (Dark Mode) */
    --success-primary: #00cc44;
    --success-dark: #00aa38;
    --success-darker: #008829;
    
    /* Danger Colors (Dark Mode) */
    --danger-primary: #ff3333;
    --danger-dark: #cc0000;
    --danger-darker: #990000;
    
    /* Warning/Coin Color */
    --coin-primary: #ff3333;
    --coin-dark: #cc0000;
    
    /* Spacing Scale */
    --space-xs: 0.5rem;
    --space-sm: 0.75rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;
    --space-2xl: 2.5rem;
    
    /* Shadow Offsets */
    --shadow-sm: 3px;
    --shadow-md: 4px;
    --shadow-lg: 6px;
    --shadow-xl: 8px;
    --shadow-2xl: 10px;
    
    /* Border Widths */
    --border-sm: 3px;
    --border-md: 4px;
}

body {
    background: var(--bg-primary);
    font-family: 'Inter', sans-serif;
    color: var(--text-primary);
}

.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

.dashboard-header {
    margin-bottom: var(--space-2xl);
    background: var(--bg-secondary);
    padding: var(--space-xl);
    border: var(--border-md) solid var(--accent-primary);
    box-shadow: var(--shadow-xl) var(--shadow-xl) 0 var(--accent-primary);
}

.dashboard-header h1 {
    font-size: 2.5rem;
    font-weight: 900;
    color: var(--accent-primary);
    margin: 0 0 var(--space-xs) 0;
    text-transform: uppercase;
    letter-spacing: -1px;
}

.dashboard-header p {
    font-size: 1.125rem;
    color: var(--text-secondary);
    margin: 0 0 var(--space-lg) 0;
    font-weight: 600;
}

.family-code-display {
    display: inline-flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md) 1.75rem;
    background: var(--bg-tertiary);
    border: var(--border-sm) solid var(--border-primary);
    box-shadow: var(--shadow-md) var(--shadow-md) 0 var(--border-primary);
}

.family-code-display strong {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.family-code {
    font-family: 'Courier New', monospace;
    font-size: 1.25rem;
    font-weight: 800;
    color: var(--text-primary);
    letter-spacing: 2px;
}

.family-code-display button {
    padding: 0.625rem 1.25rem;
    background: var(--accent-primary);
    border: var(--border-sm) solid var(--accent-primary);
    color: #000000;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.2s;
    box-shadow: var(--shadow-sm) var(--shadow-sm) 0 var(--accent-dark);
}

.family-code-display button:hover {
    background: var(--accent-dark);
    border-color: var(--accent-dark);
    transform: translate(2px, 2px);
    box-shadow: 1px 1px 0 var(--accent-dark);
}

.family-code-display button:active {
    transform: translate(var(--shadow-sm), var(--shadow-sm));
    box-shadow: 0 0 0 var(--accent-dark);
}

.parent-nav {
    display: flex;
    gap: var(--space-md);
    margin-bottom: var(--space-xl);
}

.nav-btn {
    flex: 1;
    padding: 1.25rem 1.5rem;
    text-align: center;
    text-decoration: none;
    color: var(--text-primary);
    font-size: 1rem;
    font-weight: 800;
    background: var(--bg-secondary);
    border: var(--border-md) solid var(--border-primary);
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-lg) var(--shadow-lg) 0 var(--border-primary);
}

.nav-btn:hover,
.nav-btn.active {
    background: var(--accent-primary);
    color: #000000;
    border-color: var(--accent-primary);
    box-shadow: var(--shadow-lg) var(--shadow-lg) 0 var(--accent-dark);
    transform: translate(0, 0);
}

.nav-btn:active {
    transform: translate(var(--shadow-lg), var(--shadow-lg));
    box-shadow: 0 0 0 var(--border-primary);
}

.dashboard-grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.dashboard-card {
    background: var(--bg-secondary);
    border: var(--border-md) solid var(--border-primary);
    box-shadow: var(--shadow-xl) var(--shadow-xl) 0 var(--border-primary);
    overflow: hidden;
}

.card-header {
    padding: var(--space-lg) var(--space-xl);
    background: var(--accent-primary);
    border-bottom: var(--border-md) solid var(--accent-dark);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 900;
    color: #000000;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.card-header button {
    padding: var(--space-sm) var(--space-lg);
    background: #000000;
    border: var(--border-sm) solid #000000;
    color: var(--accent-primary);
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 800;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-sm) var(--shadow-sm) 0 var(--bg-secondary);
}

.card-header button:hover {
    background: var(--bg-secondary);
    border-color: var(--bg-secondary);
    transform: translate(2px, 2px);
    box-shadow: 1px 1px 0 var(--bg-secondary);
}

.card-header button:active {
    transform: translate(var(--shadow-sm), var(--shadow-sm));
    box-shadow: 0 0 0 var(--bg-secondary);
}

.card-body {
    padding: var(--space-xl);
}

.kids-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-lg);
}

.kid-item {
    padding: 1.75rem;
    background: var(--bg-tertiary);
    border: var(--border-sm) solid var(--border-primary);
    box-shadow: 5px 5px 0 var(--border-primary);
    transition: all 0.2s;
}

.kid-item:hover {
    transform: translate(2px, 2px);
    box-shadow: 3px 3px 0 var(--border-primary);
}

.kid-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
}

.kid-info strong {
    color: var(--text-primary);
    font-weight: 800;
    font-size: 1.25rem;
    text-transform: uppercase;
}

.coin-badge {
    padding: var(--space-xs) var(--space-md);
    background: var(--accent-primary);
    border: var(--border-sm) solid var(--accent-dark);
    font-size: 0.875rem;
    color: #000000;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-sm) var(--shadow-sm) 0 var(--accent-dark);
}

.kid-actions {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    margin-top: 1.25rem;
}

.kid-actions button {
    padding: 0.875rem;
    border: var(--border-sm) solid var(--border-primary);
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 0.9375rem;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-md) var(--shadow-md) 0 var(--border-primary);
}

.kid-actions button:hover {
    background: var(--accent-primary);
    color: #000000;
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 var(--accent-dark);
}

.kid-actions button:active {
    transform: translate(var(--shadow-md), var(--shadow-md));
    box-shadow: 0 0 0 var(--border-primary);
}

.assignments-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-lg);
}

.assignment-item {
    padding: 1.75rem;
    background: var(--bg-tertiary);
    border: var(--border-sm) solid var(--border-primary);
    box-shadow: 5px 5px 0 var(--border-primary);
    transition: all 0.2s;
}

.assignment-item:hover {
    transform: translate(2px, 2px);
    box-shadow: 3px 3px 0 var(--border-primary);
}

.assignment-info {
    color: var(--text-tertiary);
    line-height: 1.8;
    font-weight: 500;
}

.assignment-info strong {
    color: var(--text-primary);
    font-weight: 800;
    font-size: 1.125rem;
    text-transform: uppercase;
}

.timestamp {
    display: block;
    font-size: 0.875rem;
    color: #666666;
    margin-top: var(--space-xs);
    font-weight: 700;
    text-transform: uppercase;
}

.purchase-cost {
    display: inline-block;
    margin-top: var(--space-sm);
    padding: 0.625rem 1.25rem;
    background: var(--accent-primary);
    border: var(--border-sm) solid var(--accent-dark);
    font-size: 1rem;
    color: #000000;
    font-weight: 800;
    box-shadow: var(--shadow-sm) var(--shadow-sm) 0 var(--accent-dark);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.assignment-actions {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    margin-top: 1.25rem;
}

.assignment-actions button {
    padding: 0.875rem;
    border: var(--border-sm) solid var(--border-primary);
    font-size: 1rem;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-md) var(--shadow-md) 0 var(--border-primary);
}

.btn-success {
    background: var(--success-primary);
    color: #ffffff;
    border-color: var(--success-primary);
}

.btn-success:hover {
    background: var(--success-dark);
    border-color: var(--success-dark);
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 var(--success-darker);
}

.btn-success:active {
    transform: translate(var(--shadow-md), var(--shadow-md));
    box-shadow: 0 0 0 var(--border-primary);
}

.btn-danger {
    background: var(--danger-primary);
    color: #ffffff;
    border-color: var(--danger-primary);
}

.btn-danger:hover {
    background: var(--danger-dark);
    border-color: var(--danger-dark);
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 var(--danger-darker);
}

.btn-danger:active {
    transform: translate(var(--shadow-md), var(--shadow-md));
    box-shadow: 0 0 0 var(--border-primary);
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: #666666;
    font-size: 1.125rem;
    font-weight: 700;
    text-transform: uppercase;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.92);
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--bg-secondary);
    border: var(--border-md) solid var(--accent-primary);
    max-width: 500px;
    width: 90%;
    box-shadow: var(--shadow-2xl) var(--shadow-2xl) 0 var(--accent-dark);
}

.modal-header {
    padding: var(--space-lg) var(--space-xl);
    background: var(--accent-primary);
    border-bottom: var(--border-md) solid var(--accent-dark);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 900;
    color: #000000;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.close {
    font-size: 2rem;
    color: #000000;
    cursor: pointer;
    line-height: 1;
    font-weight: 800;
    transition: all 0.2s;
}

.close:hover {
    color: #ffffff;
    transform: scale(1.1);
}

.modal-content form {
    padding: var(--space-xl);
}

.form-group {
    margin-bottom: var(--space-lg);
}

.form-group label {
    display: block;
    margin-bottom: var(--space-xs);
    font-size: 1rem;
    font-weight: 800;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.form-group input,
.form-group select {
    width: 100%;
    padding: var(--space-md);
    border: var(--border-sm) solid var(--border-primary);
    font-size: 1rem;
    box-sizing: border-box;
    transition: all 0.2s;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    font-weight: 600;
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--accent-primary);
    background: var(--bg-secondary);
    box-shadow: var(--shadow-md) var(--shadow-md) 0 var(--accent-primary);
}

.help-text {
    display: block;
    margin-top: var(--space-xs);
    font-size: 0.875rem;
    color: #666666;
    font-weight: 600;
    text-transform: uppercase;
}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.radio-label {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md);
    background: var(--bg-tertiary);
    border: var(--border-sm) solid var(--border-primary);
    cursor: pointer;
    transition: all 0.2s;
    font-weight: 700;
    color: var(--text-primary);
    text-transform: uppercase;
    box-shadow: var(--shadow-sm) var(--shadow-sm) 0 var(--border-primary);
}

.radio-label:hover {
    background: var(--bg-primary);
    border-color: var(--accent-primary);
    transform: translate(2px, 2px);
    box-shadow: 1px 1px 0 var(--accent-primary);
}

.modal-footer {
    display: flex;
    gap: var(--space-md);
    justify-content: flex-end;
    margin-top: var(--space-xl);
}

.modal-footer button {
    padding: var(--space-md) var(--space-xl);
    border: var(--border-sm) solid;
    font-size: 1rem;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: var(--shadow-md) var(--shadow-md) 0 var(--border-primary);
}

.btn-primary {
    background: var(--accent-primary);
    color: #000000;
    border-color: var(--accent-primary);
}

.btn-primary:hover {
    background: var(--accent-dark);
    border-color: var(--accent-dark);
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 var(--accent-darker);
}

.btn-primary:active {
    transform: translate(var(--shadow-md), var(--shadow-md));
    box-shadow: 0 0 0 var(--border-primary);
}

.btn-secondary {
    background: #95a5a6;
    color: #ffffff;
    border-color: #95a5a6;
}

.btn-secondary:hover {
    background: #7f8c8d;
    border-color: #7f8c8d;
    transform: translate(2px, 2px);
    box-shadow: 2px 2px 0 #2c3e50;
}

.btn-secondary:active {
    transform: translate(var(--shadow-md), var(--shadow-md));
    box-shadow: 0 0 0 var(--border-primary);
}

.inline-form {
    display: inline;
    width: 100%;
}

.inline-form button {
    width: 100%;
}
</style>

<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>{{ family.name }} Dashboard</h1>
        <p>Dark. Bold. Powerful.</p>
        <div class="family-code-display">
            <strong>Family Code:</strong> <span class="family-code">{{ family.family_code }}</span>
            <button onclick="copyFamilyCode('{{ family.family_code }}')">ðŸ“‹ Copy</button>
        </div>
    </div>

    <div class="parent-nav">
        <a href="{{ url_for('parent.dashboard', num=7) }}" class="nav-btn active">
            ðŸ“Š Dashboard
        </a>
        <a href="{{ url_for('parent.chores') }}" class="nav-btn">
            ðŸ“‹ Chores
        </a>
        <a href="{{ url_for('parent.store') }}" class="nav-btn">
            ðŸ›’ Store
        </a>
    </div>

    <div class="dashboard-grid">
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2>Kids</h2>
                <button onclick="toggleModal('addKidModal')">+ Add Kid</button>
            </div>
            <div class="card-body">
                {% if kids %}
                    <div class="kids-list">
                        {% for kid in kids %}
                        <div class="kid-item">
                            <div class="kid-info">
                                <strong>{{ kid.name }}</strong>
                                <span class="coin-badge">{{ kid.coin_balance }} Coins</span>
                            </div>
                            <div class="kid-actions">
                                <button type="button" onclick="toggleModal('adjustCoinsModal{{ kid.id }}')">ðŸ’° Adjust Coins</button>
                                <form method="POST" action="{{ url_for('parent.reset_pin', kid_id=kid.id) }}" class="inline-form" onsubmit="return confirm('Reset PIN for {{ kid.name }}?');">
                                    <button type="submit">ðŸ”‘ Reset PIN</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="empty-state">No kids added yet</p>
                {% endif %}
            </div>
        </div>

        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2>Pending Chore Approvals</h2>
            </div>
            <div class="card-body">
                {% if pending_assignments %}
                    <div class="assignments-list">
                        {% for assignment in pending_assignments %}
                        <div class="assignment-item">
                            <div class="assignment-info">
                                <strong>{{ assignment.kid.name }}</strong> completed 
                                <strong>{{ assignment.chore.name }}</strong>
                                <span class="timestamp">{{ assignment.completed_at.strftime('%Y-%m-%d %H:%M') if assignment.completed_at else 'Just now' }}</span>
                            </div>
                            <div class="assignment-actions">
                                <form method="POST" action="{{ url_for('parent.confirm_chore', assignment_id=assignment.id) }}" class="inline-form">
                                    <input type="hidden" name="coin_adjustment" value="{{ assignment.chore.coin_value }}">
                                    <button type="submit" class="btn-success">
                                        âœ“ Approve (+{{ assignment.chore.coin_value }} coins)
                                    </button>
                                </form>
                                <form method="POST" action="{{ url_for('parent.reject_chore', assignment_id=assignment.id) }}" class="inline-form">
                                    <button type="submit" class="btn-danger">âœ— Reject</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="empty-state">No pending chores</p>
                {% endif %}
            </div>
        </div>

        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2>Pending Purchase Requests</h2>
            </div>
            <div class="card-body">
                {% if pending_purchases %}
                    <div class="assignments-list">
                        {% for purchase in pending_purchases %}
                        <div class="assignment-item">
                            <div class="assignment-info">
                                <strong>{{ purchase.kid.name }}</strong> wants to purchase 
                                <strong>{{ purchase.item.name }}</strong>
                                {% if purchase.item.description %}
                                    <span>- {{ purchase.item.description }}</span>
                                {% endif %}
                                <span class="timestamp">{{ purchase.purchased_at.strftime('%Y-%m-%d %H:%M') if purchase.purchased_at else 'Just now' }}</span>
                                <div class="purchase-cost">{{ purchase.coin_cost }} coins</div>
                            </div>
                            <div class="assignment-actions">
                                <form method="POST" action="{{ url_for('parent.fulfill_purchase', purchase_id=purchase.id) }}" class="inline-form">
                                    <button type="submit" class="btn-success">âœ“ Fulfill</button>
                                </form>
                                <form method="POST" action="{{ url_for('parent.cancel_purchase', purchase_id=purchase.id) }}" class="inline-form">
                                    <button type="submit" class="btn-danger">âœ— Cancel & Refund</button>
                                </form>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="empty-state">No pending purchases</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<div id="addKidModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Kid</h3>
            <span class="close" onclick="toggleModal('addKidModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('parent.add_kid') }}">
            <div class="form-group">
                <label for="kid_name">Kid's Name</label>
                <input type="text" id="kid_name" name="name" required placeholder="Enter kid's name">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="toggleModal('addKidModal')">Cancel</button>
                <button type="submit" class="btn-primary">Add Kid</button>
            </div>
        </form>
    </div>
</div>

{% for kid in kids %}
<div id="adjustCoinsModal{{ kid.id }}" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Adjust Coins: {{ kid.name }}</h3>
            <span class="close" onclick="toggleModal('adjustCoinsModal{{ kid.id }}')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('parent.adjust_coins', kid_id=kid.id) }}">
            <div class="form-group">
                <label>Action</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="action" value="add" checked>
                        âž• Add Coins
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="action" value="subtract">
                        âž– Subtract Coins
                    </label>
                </div>
            </div>
            <div class="form-group">
                <label for="amount{{ kid.id }}">Amount</label>
                <input type="number" id="amount{{ kid.id }}" name="amount" min="1" required placeholder="Enter amount">
            </div>
            <div class="form-group">
                <label for="reason{{ kid.id }}">Reason (optional)</label>
                <input type="text" id="reason{{ kid.id }}" name="reason" placeholder="e.g., Good behavior">
                <small class="help-text">Shown to {{ kid.name }}</small>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="toggleModal('adjustCoinsModal{{ kid.id }}')" >Cancel</button>
                <button type="submit" class="btn-primary">Confirm</button>
            </div>
        </form>
    </div>
</div>
{% endfor %}

{% endblock %}

{% block scripts %}
<script>
function copyFamilyCode(code) {
    navigator.clipboard.writeText(code).then(() => {
        alert('Family code copied!');
    });
}

function toggleModal(modalId) {
    document.getElementById(modalId).classList.toggle('active');
}
</script>
{% endblock %}
