<div class="dashboard-grid">
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2>All Purchases</h2>
                <div class="d-flex gap-2">
                    <select id="purchaseKidFilter" class="form-control" style="width: auto;">
                        <option value="all">All Kids</option>
                        {% for kid in kids %}
                        <option value="{{ kid.id }}">{{ kid.name }}</option>
                        {% endfor %}
                    </select>
                    <select id="purchaseStatusFilter" class="form-control" style="width: auto;">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="fulfilled">Fulfilled</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
            <div class="card-body">
                {% if purchases %}
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Kid</th>
                                <th>Item</th>
                                <th>Cost</th>
                                <th>Status</th>
                                <th>Fulfilled</th>
                            </tr>
                        </thead>
                        <tbody id="purchaseTableBody">
                            {% for purchase in purchases %}
                            <tr class="purchase-row" data-kid-id="{{ purchase.kid_id }}" data-status="{{ purchase.status }}">
                                <td>{{ purchase.purchased_at.strftime('%b %d, %Y %I:%M %p') }}</td>
                                <td>
                                    <strong>{{ purchase.kid.name }}</strong>
                                </td>
                                <td>{{ purchase.item.name }}</td>
                                <td>
                                    <span class="coin-badge">
                                        üí∞ {{ purchase.coin_cost }}
                                    </span>
                                </td>
                                <td>
                                    {% if purchase.status == 'pending' %}
                                    <span class="status-badge inactive">‚è≥ Pending</span>
                                    {% elif purchase.status == 'fulfilled' %}
                                    <span class="status-badge active">‚úÖ Fulfilled</span>
                                    {% elif purchase.status == 'cancelled' %}
                                    <span class="status-badge" style="background: var(--danger-primary);">‚ùå Cancelled</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if purchase.fulfilled_at %}
                                    {{ purchase.fulfilled_at.strftime('%b %d, %Y') }}
                                    {% else %}
                                    <span class="text-muted">‚Äî</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state text-center">
                    <p style="font-size: 1.1rem; color: var(--text-muted, #666);">No purchases yet</p>
                    <p>Purchases will appear here when kids buy items from the store</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Summary Stats -->
        {% if purchases %}
        <div class="dashboard-card">
            <div class="card-header">
                <h3>Summary</h3>
            </div>
            <div class="card-body">
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">Total Purchases</div>
                        <div class="stat-value">{{ purchases|length }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Coins Spent</div>
                        <div class="stat-value">üí∞ {{ purchases|sum(attribute='coin_cost') }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Fulfilled</div>
                        <div class="stat-value">{{ purchases|selectattr('status', 'equalto', 'fulfilled')|list|length }}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Pending</div>
                        <div class="stat-value">{{ purchases|selectattr('status', 'equalto', 'pending')|list|length }}</div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
