{% extends "bases/private.html" %}

{% block title %}Manage Store - Stewardwell{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Manage Store</h1>
        <p>Rewards kids can purchase with coins</p>
    </div>

    {% include 'private/parents/components/navbar.html' %}

    <div class="dashboard-grid">
        <div class="dashboard-card full-width">
            <div class="card-header">
                <h2>Store Items</h2>
                <button onclick="toggleModal('addStoreItemModal')">+ Add Item</button>
            </div>
            <div class="card-body">
                {% if store_items %}
                    <div class="row g-3">
                        {% for item in store_items %}
                        <div class="col-12 col-md-6 col-lg-4">
                        <div class="store-item">
                            <div class="store-item-header">
                                <strong style="word-break: break-word;">{{ item.name }}</strong>
                                {% if not item.is_available %}
                                    <span class="status-badge inactive">Hidden</span>
                                {% else %}
                                    <span class="status-badge active">Available</span>
                                {% endif %}
                            </div>
                            {% if item.description %}
                                <p class="store-item-description" style="word-break: break-word;">{{ item.description }}</p>
                            {% endif %}
                            <div class="store-item-cost">
                                <span class="coin-badge">{{ item.coin_cost }} Coins</span>
                            </div>
                            <div class="store-item-actions d-flex flex-wrap gap-2">-flex flex-wrap gap-2">
                                <form method="POST" action="{{ url_for('parent.toggle_store_item', item_id=item.id) }}" class="inline-form flex-fill" style="min-width: fit-content;">
                                    <button type="submit" class="btn-secondary w-100">
                                        {% if item.is_available %}üëÅÔ∏è <span class="d-none d-sm-inline">Hide</span>{% else %}üëÅÔ∏è <span class="d-none d-sm-inline">Show</span>{% endif %}
                                    </button>
                                </form>
                                <button type="button" class="btn-danger flex-fill" onclick="if(confirm('Delete {{ item.name }}? This cannot be undone.')) document.getElementById('delete-item-form-{{ item.id }}').submit();" style="min-width: fit-content;">
                                    üóëÔ∏è <span class="d-none d-sm-inline">Delete</span>
                                </button>
                                <form id="delete-item-form-{{ item.id }}" method="POST" action="{{ url_for('parent.delete_store_item', item_id=item.id) }}" style="display: none;"></form>
                            </div>
                        </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-state text-center">
                        <p style="font-size: 1.1rem; color: var(--text-muted, #666);">No store items created yet</p>
                        <button class="btn-primary" onclick="toggleModal('addStoreItemModal')" style="margin-top: 1.5rem;">
                            + Add First Item
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Add Store Item Modal -->
<div id="addStoreItemModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Store Item</h3>
            <span class="close" onclick="toggleModal('addStoreItemModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('parent.add_store_item') }}">
            <div class="form-group mb-3">
                <label for="item_name">Item Name</label>
                <input type="text" id="item_name" name="name" required placeholder="e.g., Extra TV time, Ice cream">
            </div>
            <div class="form-group mb-3">
                <label for="item_description">Description (optional)</label>
                <textarea id="item_description" name="description" rows="3" placeholder="Describe the reward..."></textarea>
                <small class="help-text">Add details about this reward</small>
            </div>
            <div class="form-group mb-3">
                <label for="item_coin_cost">Coin Cost</label>
                <input type="number" id="item_coin_cost" name="coin_cost" min="0" value="50" required>
            </div>
            <div class="modal-footer d-flex flex-wrap gap-2 justify-content-end">
                <button type="button" class="btn-secondary" onclick="toggleModal('addStoreItemModal')">Cancel</button>
                <button type="submit" class="btn-primary">Add Item</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function toggleModal(modalId) {
    document.getElementById(modalId).classList.toggle('active');
}
</script>
{% endblock %}
