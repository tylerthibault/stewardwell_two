{% extends "bases/private.html" %}

{% block title %}Manage Store - Stewardwell{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/parent.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Manage Store</h1>
        <p>Create and manage store items for rewards</p>
    </div>

    <!-- Navigation -->
    <div class="parent-nav">
        <a href="{{ url_for('parent.dashboard') }}" class="nav-btn">
            ðŸ“Š Dashboard
        </a>
        <a href="{{ url_for('parent.chores') }}" class="nav-btn">
            ðŸ“‹ Chores
        </a>
        <a href="{{ url_for('parent.store') }}" class="nav-btn active">
            ðŸ›’ Store
        </a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="page-actions">
        <button class="btn btn-primary" onclick="toggleModal('addStoreItemModal')">+ Add New Item</button>
    </div>

    <div class="store-page-container">
        {% if store_items %}
            <div class="store-items-grid-full">
                {% for item in store_items %}
                <div class="store-item-card-full">
                    <div class="item-header">
                        <h3>{{ item.name }}</h3>
                        {% if not item.is_available %}
                            <span class="badge badge-inactive">Unavailable</span>
                        {% else %}
                            <span class="badge badge-active">Available</span>
                        {% endif %}
                    </div>
                    {% if item.description %}
                        <p class="item-description-full">{{ item.description }}</p>
                    {% endif %}
                    <div class="item-details">
                        <div class="item-cost">
                            <span class="badge badge-coin-large">ðŸª™ {{ item.coin_cost }} coins</span>
                        </div>
                    </div>
                    <div class="item-actions">
                        <form method="POST" action="{{ url_for('parent.toggle_store_item', item_id=item.id) }}" class="inline-form">
                            <button type="submit" class="btn btn-secondary btn-small">
                                {% if item.is_available %}Hide{% else %}Show{% endif %}
                            </button>
                        </form>
                        <button type="button" class="btn btn-danger btn-small" onclick="if(confirm('Delete {{ item.name }}?')) document.getElementById('delete-item-form-{{ item.id }}').submit();">
                            Delete
                        </button>
                        <form id="delete-item-form-{{ item.id }}" method="POST" action="{{ url_for('parent.delete_store_item', item_id=item.id) }}" class="hidden"></form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state-large">
                <div class="empty-icon">ðŸ›’</div>
                <h3>No Store Items Yet</h3>
                <p>Add rewards that kids can purchase with their coins!</p>
                <button class="btn btn-primary" onclick="toggleModal('addStoreItemModal')">+ Add Item</button>
            </div>
        {% endif %}
    </div>
</div>

<!-- Add Store Item Modal -->
<div id="addStoreItemModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add Store Item</h3>
            <span class="close" onclick="toggleModal('addStoreItemModal')">&times;</span>
        </div>
        <form method="POST" action="{{ url_for('parent.add_store_item') }}">
            <div class="form-group">
                <label for="item_name">Item Name</label>
                <input type="text" id="item_name" name="name" required placeholder="e.g., Extra TV time, Ice cream">
            </div>
            <div class="form-group">
                <label for="item_description">Description (optional)</label>
                <textarea id="item_description" name="description" rows="3" placeholder="Describe the reward..."></textarea>
            </div>
            <div class="form-group">
                <label for="item_coin_cost">Coin Cost</label>
                <input type="number" id="item_coin_cost" name="coin_cost" min="0" value="50" required>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="toggleModal('addStoreItemModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Item</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}
