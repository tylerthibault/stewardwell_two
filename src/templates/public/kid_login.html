{% extends "bases/public.html" %}

{% block title %}Kid Login - Stewardwell{% endblock %}

{% block nav %}{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header" style="text-align: center;">
        <h1 style="font-size: 3rem;">ðŸ‘‹ Hey Kids!</h1>
        <p style="font-size: 1.25rem;">Log in to see your chores and earn coins!</p>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <div class="dashboard-grid">
        <div class="dashboard-card">
            <div class="card-body">
                <form method="POST" action="{{ url_for('kid.kid_login') }}">
                    <div class="form-group">
                        <label for="family_code">Family Code</label>
                        <input type="text" 
                               id="family_code" 
                               name="family_code" 
                               maxlength="6" 
                               placeholder="Enter your family code"
                               style="text-transform: uppercase; text-align: center; font-size: 1.5rem; letter-spacing: 0.25rem;"
                               required>
                    </div>
                    
                    <div class="form-group">
                        <label for="pin">Your PIN</label>
                        <input type="password" 
                               id="pin" 
                               name="pin" 
                               maxlength="4" 
                               placeholder="â€¢â€¢â€¢â€¢"
                               pattern="[0-9]{4}"
                               style="text-align: center; font-size: 2rem; letter-spacing: 0.5rem;"
                               required>
                    </div>
                    
                    <div class="modal-footer" style="margin-top: 2rem; justify-content: center;">
                        <button type="submit" class="btn-primary" style="font-size: 1.25rem; padding: 1.25rem 2.5rem;">Let's Go! ðŸš€</button>
                    </div>
                </form>
                
                {% if remembered_kids %}
                <div style="margin-top: 2.5rem; padding-top: 2rem; border-top: var(--border-sm) solid var(--border-primary);">
                    <h3 style="text-align: center; font-size: 1.25rem; font-weight: 800; text-transform: uppercase; margin-bottom: 1.5rem; color: var(--text-primary);">Quick Login</h3>
                    <div class="row g-3">
                        {% for kid in remembered_kids %}
                        <div class="col-12 col-md-6">
                            <form method="POST" action="{{ url_for('kid.quick_login') }}" class="full-width">
                                <input type="hidden" name="kid_id" value="{{ kid.id }}">
                                <button type="submit" class="btn-success" style="width: 100%; font-size: 1.125rem; padding: 1.25rem;">{{ kid.name }}</button>
                            </form>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: var(--border-sm) solid var(--border-primary); text-align: center;">
                    <p style="color: var(--text-secondary); font-weight: 600; text-transform: uppercase; font-size: 0.875rem;">
                        Are you a parent? 
                        <a href="{{ url_for('auth.login') }}" style="color: var(--accent-primary); text-decoration: none; font-weight: 800;">Login here</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const familyCodeInput = document.getElementById('family_code');
    const pinInput = document.getElementById('pin');
    const loginForm = document.querySelector('form[action="{{ url_for("kid.kid_login") }}"]');
    
    // Load saved family code from localStorage
    document.addEventListener('DOMContentLoaded', function() {
        const savedFamilyCode = localStorage.getItem('kid_family_code');
        if (savedFamilyCode) {
            familyCodeInput.value = savedFamilyCode;
            // Focus on PIN field if family code is pre-filled
            pinInput.focus();
        }
    });
    
    // Auto-uppercase family code
    familyCodeInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase();
    });
    
    // Only allow numbers in PIN
    pinInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/[^0-9]/g, '');
    });
    
    // Save family code to localStorage on successful form submission
    loginForm.addEventListener('submit', function(e) {
        const familyCode = familyCodeInput.value.trim();
        if (familyCode) {
            localStorage.setItem('kid_family_code', familyCode);
        }
    });
</script>
{% endblock %}
